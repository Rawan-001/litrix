const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PublicationsOverTime-GxC80P8Z.js","assets/index-DirEgLJ3.js","assets/index-CxPg6Jlk.css","assets/GridLoader-B4dWDiCY.js","assets/generateCategoricalChart-C4XmfqJR.js","assets/clsx-B-dksMZM.js","assets/CitesPerYearChart-D-CAZYbn.js","assets/BarChart-DvnP8pcN.js"])))=>i.map(i=>d[i]);
import{y as Z,r as f,f as D,F as A,M as ee,j as e,a as g,m as T,e as w,q as N,c as S,b as u,o as z,n as C,g as j,d as _,bx as G}from"./index-DirEgLJ3.js";import{H as se}from"./Header-DIQgaVcq.js";import{V as te}from"./DashboardViewSwitcher-Dyrw3rW0.js";import{G as P}from"./GridLoader-B4dWDiCY.js";import{B as oe,T as B}from"./Box-BEO0Rqom.js";import"./clsx-B-dksMZM.js";const le=f.lazy(()=>G(()=>import("./PublicationsOverTime-GxC80P8Z.js"),__vite__mapDeps([0,1,2,3,4,5]))),ie=f.lazy(()=>G(()=>import("./CitesPerYearChart-D-CAZYbn.js"),__vite__mapDeps([6,1,2,3,4,5,7]))),re=({name:m,icon:o,value:a,color:E,detail:p})=>{const i=a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:e.jsx("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 h-full",children:e.jsxs(oe,{sx:{p:2},children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"rounded-md p-2 mr-3 text-white flex items-center justify-center",style:{backgroundColor:E},children:e.jsx(o,{size:18})}),e.jsx("div",{children:e.jsx(B,{variant:"subtitle2",className:"text-gray-600 font-medium",children:m})})]}),e.jsx(B,{variant:"h5",className:"font-bold ml-10",style:{color:E},children:i}),p&&e.jsx(B,{variant:"body2",className:"text-gray-500 text-xs ml-10",children:p})]})})})},he=({academicAdminAsResearcher:m=!1,academicAdminData:o=null,researcherData:a=null,userData:E=null,departmentAdminAsResearcher:p=!1,departmentAdminData:i=null})=>{const k=Z(),[V,v]=f.useState(null),[I,y]=f.useState(0),[U,b]=f.useState(0),[H,x]=f.useState(!0),[F,h]=f.useState(!0),Q=n=>{m&&n==="admin"?k("/admin-dashboard"):p&&n==="admin"&&k("/department-dashboard")};f.useEffect(()=>{(async()=>{if(a){v(a),a.citedby!==void 0&&b(a.citedby);try{const s=a.college||(o==null?void 0:o.college)||"faculty_computing",r=a.department||(o==null?void 0:o.department)||"dept_cs",t=a.id||a.scholar_id;if(t){const l=await w(N(S(u,`colleges/${s}/departments/${r}/faculty_members/${t}/publications`),z("num_citations","desc"),C(50)));y(l.size)}}catch(s){console.error("Error fetching publications count:",s)}x(!1),h(!1);return}if(p&&i){try{const s=i.scholarId||i.scholar_id,r=i.college||"faculty_computing",t=i.department||"dept_cs";if(!s){x(!1),h(!1);return}const[l,d]=await Promise.all([j(_(u,`colleges/${r}/departments/${t}/faculty_members/${s}`)),w(N(S(u,`colleges/${r}/departments/${t}/faculty_members/${s}/publications`),z("num_citations","desc"),C(50)))]);if(l.exists()){const c=l.data();v(c),y(d.size),b(c.citedby||0)}}finally{x(!1),h(!1)}return}if(m&&o){try{const s=o.scholar_id,r=o.college||"faculty_computing",t=o.department||"dept_cs";if(!s){x(!1),h(!1);return}const[l,d]=await Promise.all([j(_(u,`colleges/${r}/departments/${t}/faculty_members/${s}`)),w(N(S(u,`colleges/${r}/departments/${t}/faculty_members/${s}/publications`),z("num_citations","desc"),C(50)))]);if(l.exists()){const c=l.data();v(c),y(d.size),b(c.citedby||0)}}finally{x(!1),h(!1)}return}if(!g.currentUser){x(!1);return}try{const s=_(u,`users/${g.currentUser.uid}`),r=await j(s);if(r.exists()){const t=r.data();t.publications_count&&y(t.publications_count),t.citations_count&&b(t.citations_count),await Y(t)}else{const t=_(u,`departmentAdmins/${g.currentUser.uid}`),l=await j(t);if(l.exists()){const d=l.data(),c=d.scholarId||d.scholar_id;if(c){const L=d.college||"faculty_computing",$=d.department||"dept_cs",[M,X]=await Promise.all([j(_(u,`colleges/${L}/departments/${$}/faculty_members/${c}`)),w(N(S(u,`colleges/${L}/departments/${$}/faculty_members/${c}/publications`),z("num_citations","desc"),C(50)))]);if(M.exists()){const q=M.data();v(q),y(X.size),b(q.citedby||0)}}}}}catch(s){console.error("Error fetching initial data:",s)}finally{x(!1),h(!1)}})()},[m,o,p,i,a,E]);const Y=async n=>{try{const{scholar_id:s,college:r,department:t}=n,l=r||"faculty_computing",d=t||"dept_cs";if(!s){h(!1);return}const[c,L]=await Promise.all([j(_(u,`colleges/${l}/departments/${d}/faculty_members/${s}`)),w(N(S(u,`colleges/${l}/departments/${d}/faculty_members/${s}/publications`),z("num_citations","desc"),C(50)))]);if(c.exists()){const $=c.data();v($),y(L.size),b($.citedby||0)}}catch(s){console.error("Error fetching detailed data:",s)}finally{h(!1)}},J=f.useMemo(()=>[{name:"Total Publications",icon:D,value:I,color:"rgb(29 78 216)"},{name:"Total Citations",icon:A,value:U,color:"rgb(29 78 216)"},{name:"Citation Rate",icon:ee,value:I>0?(U/I).toFixed(1):0,color:"rgb(29 78 216)",detail:"Citations per publication"}],[I,U]);if(H)return e.jsx("div",{className:"flex-1 relative z-10 overflow-auto",children:e.jsx("main",{className:"mx-auto py-6 px-4 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(P,{size:30,color:"#1d4ed8"})})})});const O=p||g.currentUser&&g.currentUser.uid&&!!i,R=m||g.currentUser&&g.currentUser.uid&&!!o,K=O||R,W=(i==null?void 0:i.department)||(o==null?void 0:o.department)||"dept_cs";return e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(se,{title:"Researcher Dashboard",showViewSwitcher:!1,isDepartmentAdmin:O,isAcademicAdmin:R}),e.jsx("div",{className:"flex-1 relative z-10 overflow-auto",children:e.jsxs("main",{className:"mx-auto py-6 px-4 lg:px-8",children:[K&&e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(te,{currentView:"researcher",departmentCode:W,onClick:Q})}),e.jsx(T.div,{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 mb-8",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:J.map((n,s)=>e.jsx(re,{name:n.name,icon:n.icon,value:n.value,color:n.color,detail:n.detail},s))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1},className:"bg-white shadow-lg rounded-lg p-6 border border-gray-200",children:e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:15,color:"#1d4ed8"})}),children:F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:15,color:"#1d4ed8"})}):V?e.jsx(le,{researcher:V}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500",children:"No researcher data available"})})})}),e.jsx(T.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},className:"bg-white shadow-lg rounded-lg p-6 border border-gray-200",children:e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:15,color:"#1d4ed8"})}),children:F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:15,color:"#1d4ed8"})}):V?e.jsx(ie,{researcher:V}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500",children:"No researcher data available"})})})})]})]})})]})};export{he as default};

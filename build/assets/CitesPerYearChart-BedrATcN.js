import{r as d,a as H,j as e,m as S,d as M,b as L,g as A}from"./index-IRUkcUQr.js";import{G as V}from"./GridLoader-DRl0MpW0.js";import{R as X,C as q,X as J,Y as Q,T as U,H as F,w as Z,F as ee}from"./generateCategoricalChart-BQQ0_7Rj.js";import{B as te}from"./BarChart-CttJ__3G.js";import"./clsx-B-dksMZM.js";const de=({researcher:x=null,role:p="researcher",customColor:w="#4F46E5",showFilters:Y=!0})=>{var I,D;const[u,C]=d.useState([]),[T,g]=d.useState(!0),[se,E]=d.useState(null),[ae,_]=d.useState(null),[re,k]=d.useState(null),[y,B]=d.useState(null),[v,z]=d.useState("Citations"),c=d.useMemo(()=>{const s={researcher:{primary:w||"#4F46E5",secondary:"#818CF8",gradient:["#4F46E5","#818CF8","#C7D2FE"],highlight:"#312E81"},admin:{primary:"#2563EB",secondary:"#60A5FA",gradient:["#1E40AF","#3B82F6","#93C5FD"],highlight:"#1E3A8A"},visitor:{primary:"#10B981",secondary:"#34D399",gradient:["#047857","#10B981","#6EE7B7"],highlight:"#065F46"}};return s[p]||s.researcher},[p,w]),R=async s=>{try{const t=M(L,`users/${s}`),i=await A(t);if(i.exists()){const a=i.data();return{scholar_id:a.scholar_id,college:a.college||"faculty_computing",department:a.department||"dept_cs"}}}catch(t){console.error("Error fetching scholar ID: ",t)}return null},$=async(s,t,i)=>{g(!0);try{const a=M(L,`colleges/${t}/departments/${i}/faculty_members/${s}`),r=await A(a);if(r.exists()){const h=r.data(),n=h.cites_per_year||{},o=h.h_index||0,f=h.i10_index||0,l=Object.keys(n).sort((j,m)=>parseInt(j)-parseInt(m)),W=l.map((j,m)=>{let b=n[j],N=1;return m>0&&l[m-1]&&(b+=n[l[m-1]],N++),m<l.length-1&&l[m+1]&&(b+=n[l[m+1]],N++),{year:parseInt(j),citations:n[j],avg:Math.round(b/N),h_index:o,i10_index:f}});C(W)}else console.error("No such document!")}catch(a){console.error("Error fetching cites_per_year:",a)}finally{g(!1)}},P=s=>{if(!s)return;const t=s.cites_per_year||{},i=s.h_index||0,a=s.i10_index||0,r=Object.keys(t).sort((n,o)=>parseInt(n)-parseInt(o)),h=r.map((n,o)=>{let f=t[n],l=1;return o>0&&r[o-1]&&(f+=t[r[o-1]],l++),o<r.length-1&&r[o+1]&&(f+=t[r[o+1]],l++),{year:parseInt(n),citations:t[n],avg:Math.round(f/l),h_index:i,i10_index:a}});C(h),g(!1)};d.useEffect(()=>{if(x)E(x.id||x.scholar_id),_(x.college||"faculty_computing"),k(x.department||"dept_cs"),setTimeout(()=>{g(!1)},800),P(x);else{const s=H.onAuthStateChanged(async t=>{if(t){const i=await R(t.uid);if(i){const{scholar_id:a,college:r,department:h}=i;E(a),_(r),k(h),$(a,r,h)}else g(!1)}else g(!1)});return()=>s()}},[x]);const G=s=>{z(s.target.value)},K=s=>{if(y!==null&&y!==s)return`${c.primary}80`;const t=Math.min(Math.floor(s/u.length*c.gradient.length),c.gradient.length-1);return c.gradient[t]},O=({active:s,payload:t,label:i})=>{var a;return s&&t&&t.length?e.jsxs("div",{className:"bg-white p-4 rounded-md shadow-lg border border-gray-200",children:[e.jsx("p",{className:"text-gray-700 font-semibold text-lg border-b pb-2 mb-2",children:i}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:c.primary}}),e.jsx("span",{className:"text-gray-600 mr-2",children:"Citations:"}),e.jsx("span",{className:"font-semibold",children:t[0].value})]}),v==="Both"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:c.secondary}}),e.jsx("span",{className:"text-gray-600 mr-2",children:"3-Year Avg:"}),e.jsx("span",{className:"font-semibold",children:(a=t[1])==null?void 0:a.value})]}),p==="admin"&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"h-index:"}),e.jsx("span",{className:"font-medium",children:t[0].payload.h_index})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"i10-index:"}),e.jsx("span",{className:"font-medium",children:t[0].payload.i10_index})]})]})]})]}):null};return T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(V,{size:15,color:c.primary,loading:!0})}):u.length===0?e.jsxs(S.div,{className:"bg-white shadow-lg rounded-xl p-6 border border-gray-300 mb-8 flex flex-col items-center justify-center h-64",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx("svg",{className:"w-16 h-16 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Citation Data Available"}),e.jsx("p",{className:"text-gray-500 text-center",children:"Citation data will appear as your research is cited by others."})]}):e.jsxs(S.div,{className:"bg-white shadow-lg rounded-xl overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Citations Impact"}),Y&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:v,onChange:G,className:"appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"Citations",children:"Citations Only"}),e.jsx("option",{value:"Both",children:"Citations & 3-Year Avg"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),p!=="visitor"&&e.jsxs("div",{className:"flex mt-2 space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"Total Citations:"}),e.jsx("span",{className:"font-medium",children:u.reduce((s,t)=>s+t.citations,0)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"h-index:"}),e.jsx("span",{className:"font-medium",children:((I=u[0])==null?void 0:I.h_index)||"-"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"i10-index:"}),e.jsx("span",{className:"font-medium",children:((D=u[0])==null?void 0:D.i10_index)||"-"})]})]})]}),e.jsx("div",{className:"px-4 py-4",style:{height:380},children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(te,{data:u,margin:{top:20,right:30,left:0,bottom:20},onMouseMove:s=>{s&&s.activeTooltipIndex!==void 0&&B(s.activeTooltipIndex)},onMouseLeave:()=>B(null),children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"#EEEEEE",vertical:!1}),e.jsx(J,{dataKey:"year",stroke:"#6B7280",axisLine:{stroke:"#E5E7EB"},tickLine:{stroke:"#E5E7EB"},padding:{left:10,right:10}}),e.jsx(Q,{stroke:"#6B7280",axisLine:{stroke:"#E5E7EB"},tickLine:!1}),e.jsx(U,{content:e.jsx(O,{}),cursor:{fill:"rgba(224, 231, 255, 0.2)"}}),e.jsx(F,{dataKey:"citations",radius:[4,4,0,0],barSize:v==="Both"?25:35,animationDuration:1e3,children:u.map((s,t)=>e.jsx(Z,{fill:K(t),style:{transition:"fill 0.3s ease",cursor:"pointer",filter:y===t?"brightness(1.1) saturate(1.1)":"none",stroke:y===t?c.highlight:"none",strokeWidth:1}},`cell-${t}`))}),v==="Both"&&e.jsx(F,{dataKey:"avg",fill:c.secondary,radius:[4,4,0,0],barSize:25,animationDuration:1500}),e.jsx(ee,{iconType:"circle",iconSize:8,formatter:s=>s==="citations"?"Citations":"3-Year Average",wrapperStyle:{paddingTop:"10px"}})]})})}),p==="admin"&&e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Citation data is updated monthly from academic databases."})]})})]})};export{de as default};

import{R as x,r as C,a as ut,j as l,m as dt,c as pt,b as Q,e as ft,d as mt,g as ht}from"./index-DirEgLJ3.js";import{G as yt}from"./GridLoader-B4dWDiCY.js";import{f as T,L as W,N as V,q as z,j as Y,A as vt,n as $,k as J,O as gt,o as U,J as bt,s as xt,u as At,i as G,G as jt,l as Z,K as tt,D as Ot,B as Pt,X as nt,Y as it,M as wt,R as _t,C as Et,T as kt,F as St}from"./generateCategoricalChart-C4XmfqJR.js";import{c as rt}from"./clsx-B-dksMZM.js";var Nt=["layout","type","stroke","connectNulls","isRange","ref"],Dt=["key"],ot;function I(t){"@babel/helpers - typeof";return I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(t)}function st(t,e){if(t==null)return{};var n=Lt(t,e),a,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)a=o[i],!(e.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}function Lt(t,e){if(t==null)return{};var n={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(e.indexOf(a)>=0)continue;n[a]=t[a]}return n}function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},M.apply(this,arguments)}function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,a)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?et(Object(n),!0).forEach(function(a){L(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,ct(a.key),a)}}function Rt(t,e,n){return e&&at(t.prototype,e),n&&at(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bt(t,e,n){return e=K(e),Mt(t,lt()?Reflect.construct(e,n||[],K(t).constructor):e.apply(t,n))}function Mt(t,e){if(e&&(I(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Tt(t)}function Tt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lt=function(){return!!t})()}function K(t){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},K(t)}function $t(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},X(t,e)}function L(t,e,n){return e=ct(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ct(t){var e=zt(t,"string");return I(e)=="symbol"?e:e+""}function zt(t,e){if(I(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var a=n.call(t,e);if(I(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var R=function(t){function e(){var n;Ct(this,e);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return n=Bt(this,e,[].concat(i)),L(n,"state",{isAnimationFinished:!0}),L(n,"id",At("recharts-area-")),L(n,"handleAnimationEnd",function(){var r=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),G(r)&&r()}),L(n,"handleAnimationStart",function(){var r=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),G(r)&&r()}),n}return $t(e,t),Rt(e,[{key:"renderDots",value:function(a,i,o){var r=this.props.isAnimationActive,u=this.state.isAnimationFinished;if(r&&!u)return null;var d=this.props,c=d.dot,h=d.points,f=d.dataKey,g=T(this.props,!1),w=T(c,!0),_=h.map(function(y,S){var j=B(B(B({key:"dot-".concat(S),r:3},g),w),{},{index:S,cx:y.x,cy:y.y,dataKey:f,value:y.value,payload:y.payload,points:h});return e.renderDotItem(c,j)}),E={clipPath:a?"url(#clipPath-".concat(i?"":"dots-").concat(o,")"):null};return x.createElement(W,M({className:"recharts-area-dots"},E),_)}},{key:"renderHorizontalRect",value:function(a){var i=this.props,o=i.baseLine,r=i.points,u=i.strokeWidth,d=r[0].x,c=r[r.length-1].x,h=a*Math.abs(d-c),f=V(r.map(function(g){return g.y||0}));return z(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(V(o.map(function(g){return g.y||0})),f)),z(f)?x.createElement("rect",{x:d<c?d:d-h,y:0,width:h,height:Math.floor(f+(u?parseInt("".concat(u),10):1))}):null}},{key:"renderVerticalRect",value:function(a){var i=this.props,o=i.baseLine,r=i.points,u=i.strokeWidth,d=r[0].y,c=r[r.length-1].y,h=a*Math.abs(d-c),f=V(r.map(function(g){return g.x||0}));return z(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(V(o.map(function(g){return g.x||0})),f)),z(f)?x.createElement("rect",{x:0,y:d<c?d:d-h,width:f+(u?parseInt("".concat(u),10):1),height:Math.floor(h)}):null}},{key:"renderClipRect",value:function(a){var i=this.props.layout;return i==="vertical"?this.renderVerticalRect(a):this.renderHorizontalRect(a)}},{key:"renderAreaStatically",value:function(a,i,o,r){var u=this.props,d=u.layout,c=u.type,h=u.stroke,f=u.connectNulls,g=u.isRange;u.ref;var w=st(u,Nt);return x.createElement(W,{clipPath:o?"url(#clipPath-".concat(r,")"):null},x.createElement(Y,M({},T(w,!0),{points:a,connectNulls:f,type:c,baseLine:i,layout:d,stroke:"none",className:"recharts-area-area"})),h!=="none"&&x.createElement(Y,M({},T(this.props,!1),{className:"recharts-area-curve",layout:d,type:c,connectNulls:f,fill:"none",points:a})),h!=="none"&&g&&x.createElement(Y,M({},T(this.props,!1),{className:"recharts-area-curve",layout:d,type:c,connectNulls:f,fill:"none",points:i})))}},{key:"renderAreaWithAnimation",value:function(a,i){var o=this,r=this.props,u=r.points,d=r.baseLine,c=r.isAnimationActive,h=r.animationBegin,f=r.animationDuration,g=r.animationEasing,w=r.animationId,_=this.state,E=_.prevPoints,y=_.prevBaseLine;return x.createElement(vt,{begin:h,duration:f,isActive:c,easing:g,from:{t:0},to:{t:1},key:"area-".concat(w),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(S){var j=S.t;if(E){var N=E.length/u.length,b=u.map(function(s,k){var v=Math.floor(k*N);if(E[v]){var O=E[v],D=$(O.x,s.x),P=$(O.y,s.y);return B(B({},s),{},{x:D(j),y:P(j)})}return s}),A;if(z(d)&&typeof d=="number"){var p=$(y,d);A=p(j)}else if(J(d)||gt(d)){var m=$(y,0);A=m(j)}else A=d.map(function(s,k){var v=Math.floor(k*N);if(y[v]){var O=y[v],D=$(O.x,s.x),P=$(O.y,s.y);return B(B({},s),{},{x:D(j),y:P(j)})}return s});return o.renderAreaStatically(b,A,a,i)}return x.createElement(W,null,x.createElement("defs",null,x.createElement("clipPath",{id:"animationClipPath-".concat(i)},o.renderClipRect(j))),x.createElement(W,{clipPath:"url(#animationClipPath-".concat(i,")")},o.renderAreaStatically(u,d,a,i)))})}},{key:"renderArea",value:function(a,i){var o=this.props,r=o.points,u=o.baseLine,d=o.isAnimationActive,c=this.state,h=c.prevPoints,f=c.prevBaseLine,g=c.totalLength;return d&&r&&r.length&&(!h&&g>0||!U(h,r)||!U(f,u))?this.renderAreaWithAnimation(a,i):this.renderAreaStatically(r,u,a,i)}},{key:"render",value:function(){var a,i=this.props,o=i.hide,r=i.dot,u=i.points,d=i.className,c=i.top,h=i.left,f=i.xAxis,g=i.yAxis,w=i.width,_=i.height,E=i.isAnimationActive,y=i.id;if(o||!u||!u.length)return null;var S=this.state.isAnimationFinished,j=u.length===1,N=rt("recharts-area",d),b=f&&f.allowDataOverflow,A=g&&g.allowDataOverflow,p=b||A,m=J(y)?this.id:y,s=(a=T(r,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},k=s.r,v=k===void 0?3:k,O=s.strokeWidth,D=O===void 0?2:O,P=bt(r)?r:{},H=P.clipDot,q=H===void 0?!0:H,F=v*2+D;return x.createElement(W,{className:N},b||A?x.createElement("defs",null,x.createElement("clipPath",{id:"clipPath-".concat(m)},x.createElement("rect",{x:b?h:h-w/2,y:A?c:c-_/2,width:b?w:w*2,height:A?_:_*2})),!q&&x.createElement("clipPath",{id:"clipPath-dots-".concat(m)},x.createElement("rect",{x:h-F/2,y:c-F/2,width:w+F,height:_+F}))):null,j?null:this.renderArea(p,m),(r||j)&&this.renderDots(p,q,m),(!E||S)&&xt.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(a,i){return a.animationId!==i.prevAnimationId?{prevAnimationId:a.animationId,curPoints:a.points,curBaseLine:a.baseLine,prevPoints:i.curPoints,prevBaseLine:i.curBaseLine}:a.points!==i.curPoints||a.baseLine!==i.curBaseLine?{curPoints:a.points,curBaseLine:a.baseLine}:null}}])}(C.PureComponent);ot=R;L(R,"displayName","Area");L(R,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!jt.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});L(R,"getBaseValue",function(t,e,n,a){var i=t.layout,o=t.baseValue,r=e.props.baseValue,u=r??o;if(z(u)&&typeof u=="number")return u;var d=i==="horizontal"?a:n,c=d.scale.domain();if(d.type==="number"){var h=Math.max(c[0],c[1]),f=Math.min(c[0],c[1]);return u==="dataMin"?f:u==="dataMax"||h<0?h:Math.max(Math.min(c[0],c[1]),0)}return u==="dataMin"?c[0]:u==="dataMax"?c[1]:c[0]});L(R,"getComposedData",function(t){var e=t.props,n=t.item,a=t.xAxis,i=t.yAxis,o=t.xAxisTicks,r=t.yAxisTicks,u=t.bandSize,d=t.dataKey,c=t.stackedData,h=t.dataStartIndex,f=t.displayedData,g=t.offset,w=e.layout,_=c&&c.length,E=ot.getBaseValue(e,n,a,i),y=w==="horizontal",S=!1,j=f.map(function(b,A){var p;_?p=c[h+A]:(p=Z(b,d),Array.isArray(p)?S=!0:p=[E,p]);var m=p[1]==null||_&&Z(b,d)==null;return y?{x:tt({axis:a,ticks:o,bandSize:u,entry:b,index:A}),y:m?null:i.scale(p[1]),value:p,payload:b}:{x:m?null:a.scale(p[1]),y:tt({axis:i,ticks:r,bandSize:u,entry:b,index:A}),value:p,payload:b}}),N;return _||S?N=j.map(function(b){var A=Array.isArray(b.value)?b.value[0]:null;return y?{x:b.x,y:A!=null&&b.y!=null?i.scale(A):null}:{x:A!=null?a.scale(A):null,y:b.y}}):N=y?i.scale(E):a.scale(E),B({points:j,baseLine:N,layout:w,isRange:S},g)});L(R,"renderDotItem",function(t,e){var n;if(x.isValidElement(t))n=x.cloneElement(t,e);else if(G(t))n=t(e);else{var a=rt("recharts-area-dot",typeof t!="boolean"?t.className:""),i=e.key,o=st(e,Dt);n=x.createElement(Ot,M({},o,{key:i,className:a}))}return n});var It=Pt({chartName:"AreaChart",GraphicalChild:R,axisComponents:[{axisType:"xAxis",AxisComp:nt},{axisType:"yAxis",AxisComp:it}],formatAxisMap:wt});const Yt=({researcher:t=null,role:e="researcher",customColor:n="#4F46E5",showFilters:a=!0})=>{const[i,o]=C.useState([]),[r,u]=C.useState("Yearly"),[d,c]=C.useState(!0),[h,f]=C.useState(null),[g,w]=C.useState(null),[_,E]=C.useState(null),y=C.useMemo(()=>{const p={researcher:{primary:n||"#4F46E5",secondary:"#818CF8",gradient:["rgba(79, 70, 229, 0.8)","rgba(79, 70, 229, 0)"]},admin:{primary:"#2563EB",secondary:"#60A5FA",gradient:["rgba(37, 99, 235, 0.8)","rgba(37, 99, 235, 0)"]},visitor:{primary:"#10B981",secondary:"#34D399",gradient:["rgba(16, 185, 129, 0.8)","rgba(16, 185, 129, 0)"]}};return p[e]||p.researcher},[e,n]),S=async p=>{try{const m=mt(Q,`users/${p}`),s=await ht(m);if(s.exists()){const k=s.data();return{scholar_id:k.scholar_id,college:k.college||"faculty_computing",department:k.department||"dept_cs"}}}catch(m){console.error("Error fetching user data: ",m)}return null},j=async(p,m,s)=>{c(!0);try{console.log(`Fetching publications for ${p} in ${m}/${s}`);const k=pt(Q,`colleges/${m}/departments/${s}/faculty_members/${p}/publications`),O=(await ft(k)).docs.map(P=>P.data()),D=N(O,r);o(D),c(!1)}catch(k){console.error("Error fetching publications: ",k),c(!1)}},N=(p,m)=>{const s={};return p.forEach(v=>{const O=v.pub_year;if(O){if(m==="Yearly")s[O]?(s[O].count+=1,s[O].citations+=v.num_citations||0):s[O]={count:1,citations:v.num_citations||0};else if(m==="Quarterly"){const D=Math.ceil(v.pub_month/3),P=`${O}-Q${D}`;s[P]?(s[P].count+=1,s[P].citations+=v.num_citations||0):s[P]={count:1,citations:v.num_citations||0}}else if(m==="Monthly"&&v.pub_month){const D=v.pub_month.toString().padStart(2,"0"),P=`${O}-${D}`;s[P]?(s[P].count+=1,s[P].citations+=v.num_citations||0):s[P]={count:1,citations:v.num_citations||0}}}}),Object.keys(s).sort().map(v=>({name:v,publications:s[v].count,citations:s[v].citations}))};C.useEffect(()=>{if(t)if(f(t.id||t.scholar_id),w(t.college||"faculty_computing"),E(t.department||"dept_cs"),setTimeout(()=>{c(!1)},800),t.publications&&t.publications.length>0){const p=N(t.publications,r);o(p)}else(t.id||t.scholar_id)&&j(t.id||t.scholar_id,t.college||"faculty_computing",t.department||"dept_cs");else{const p=ut.onAuthStateChanged(async m=>{if(m){const s=await S(m.uid);s&&s.scholar_id?(f(s.scholar_id),w(s.college),E(s.department),j(s.scholar_id,s.college,s.department)):c(!1)}else c(!1)});return()=>p()}},[t,r]);const b=p=>{if(u(p.target.value),t&&t.publications){const m=N(t.publications,p.target.value);o(m)}else h&&j(h,g,_)},A=({active:p,payload:m,label:s})=>p&&m&&m.length?l.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border border-gray-200",children:[l.jsx("p",{className:"font-medium text-gray-900",children:s}),l.jsxs("p",{className:"text-sm text-gray-800",children:[l.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:y.primary}}),"Publications: ",l.jsx("span",{className:"font-medium",children:m[0].value})]}),m[1]&&l.jsxs("p",{className:"text-sm text-gray-800",children:[l.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:y.secondary}}),"Citations: ",l.jsx("span",{className:"font-medium",children:m[1].value})]})]}):null;return d?l.jsx("div",{className:"flex justify-center items-center h-64",children:l.jsx(yt,{size:15,color:y.primary,loading:!0})}):l.jsxs(dt.div,{className:"h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Research Publications Over Time"}),a&&l.jsxs("div",{className:"relative",children:[l.jsxs("select",{value:r,onChange:b,className:"appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[l.jsx("option",{value:"Yearly",children:"Yearly"}),l.jsx("option",{value:"Quarterly",children:"Quarterly"}),l.jsx("option",{value:"Monthly",children:"Monthly"})]}),l.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:l.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:l.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),i.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-60 bg-gray-50 rounded-lg border border-gray-200",children:[l.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),l.jsx("p",{className:"text-gray-500 text-center",children:"No publication data available for this time range."}),l.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Try changing the time filter or check back later."})]}):l.jsx("div",{style:{width:"100%",height:300},children:l.jsx(_t,{children:l.jsxs(It,{data:i,margin:{top:10,right:30,left:0,bottom:0},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"colorPublications",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:y.gradient[0],stopOpacity:.8}),l.jsx("stop",{offset:"95%",stopColor:y.gradient[1],stopOpacity:0})]}),l.jsxs("linearGradient",{id:"colorCitations",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:y.secondary,stopOpacity:.8}),l.jsx("stop",{offset:"95%",stopColor:y.secondary,stopOpacity:0})]})]}),l.jsx(Et,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),l.jsx(nt,{dataKey:"name",stroke:"#6B7280",fontSize:12,tickLine:!1,axisLine:{stroke:"#E5E7EB"}}),l.jsx(it,{stroke:"#6B7280",fontSize:12,tickLine:!1,axisLine:{stroke:"#E5E7EB"}}),l.jsx(kt,{content:l.jsx(A,{})}),l.jsx(St,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"12px"}}),l.jsx(R,{type:"monotone",dataKey:"publications",stroke:y.primary,fillOpacity:1,fill:"url(#colorPublications)",strokeWidth:2,activeDot:{r:6,strokeWidth:0}}),e==="admin"&&l.jsx(R,{type:"monotone",dataKey:"citations",stroke:y.secondary,fillOpacity:.5,fill:"url(#colorCitations)",strokeWidth:2,activeDot:{r:6,strokeWidth:0}})]})})})]})};export{Yt as default};

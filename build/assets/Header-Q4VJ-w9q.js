import{aQ as p,aR as L,a as u,aS as k,aT as C,y as T,aU as _,r as n,g as A,d as D,q as E,o as O,c as z,aV as B,j as e,b as h}from"./index-IRUkcUQr.js";function H(t){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"},child:[]},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"},child:[]}]})(t)}function M(t){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(t)}const q=async()=>{try{await L(u,k),console.log("Session persistence set successfully")}catch(t){console.error("Error setting session persistence:",t)}},P=async()=>{try{const t=sessionStorage.getItem("currentTabId");return await C(u),sessionStorage.removeItem("currentTabId"),console.log("Logged out successfully"),{success:!0}}catch(t){return console.error("Logout error:",t),{success:!1,error:t}}},U=()=>{if(!sessionStorage.getItem("currentTabId")){const t=`tab_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;sessionStorage.setItem("currentTabId",t),console.log(`Created new tab ID: ${t}`)}return sessionStorage.getItem("currentTabId")},F=({title:t})=>{const f=T(),b=_(),[r,l]=n.useState(null),[c,m]=n.useState([]),[y,j]=n.useState(!1),[w,g]=n.useState(!1),N=()=>!(b.pathname.includes("academic-dashboard")&&t==="Academic Admin Dashboard");n.useEffect(()=>{U(),q();const s=u.onAuthStateChanged(async o=>{if(!o){l(null);return}const i=o.uid;for(const[x,d]of[["users","researcher"],["admins","admin"],["departmentAdmins","department_admin"]]){const a=await A(D(h,x,i));if(a.exists()){const I=a.data();l({uid:i,role:d,...I});return}}l({uid:i,role:"unknown"})});return()=>s()},[]),n.useEffect(()=>{if(!r){m([]);return}const s=E(z(h,"notifications"),O("timestamp","desc")),o=B(s,i=>{const d=i.docs.map(a=>({id:a.id,...a.data()})).filter(a=>r.role==="researcher"?a.recipientId===r.uid:r.role==="admin"?["system","manual","new_publication"].includes(a.type):r.role==="department_admin"?a.departmentId===r.department:!1);m(d)},console.error);return()=>o()},[r]);const v=async()=>{g(!0);const s=await P();g(!1),s.success?f("/"):console.error("Logout failed:",s.error)},S=()=>{j(s=>!s)};return N()?e.jsx("header",{className:"bg-white shadow-lg border-b border-gray-300",children:e.jsxs("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t}),r&&e.jsxs("div",{className:"flex items-center space-x-4 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{size:24,className:"text-gray-900 cursor-pointer hover:text-blue-500",onClick:S}),c.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:c.length}),y&&e.jsxs("div",{className:"absolute right-0 mt-3 w-80 bg-white rounded-lg shadow-xl z-50 border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-200 bg-gray-50",children:e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Notifications"})}),c.length>0?e.jsx("div",{className:"max-h-60 overflow-y-auto",children:c.map(s=>{var o;return e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500",children:s.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:(o=s.timestamp)==null?void 0:o.toDate().toLocaleString()})]},s.id)})}):e.jsx("div",{className:"px-4 py-4 text-sm text-gray-500 text-center",children:"No notifications"})]})]}),r.role==="department_admin"&&e.jsx("div",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:r.department.replace("dept_","").toUpperCase()}),e.jsx("button",{onClick:v,disabled:w,className:"flex items-center text-gray-900 cursor-pointer hover:text-red-500 disabled:opacity-50",children:e.jsx(M,{size:24})})]})]})}):null};export{F as H};
